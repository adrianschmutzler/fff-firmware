#!/bin/sh

# Copyright Adrian Schmutzler, 2018.
# License GPLv3

#load uci functions
. /lib/functions.sh

fix_mtu() {
	# Usage: fix_mtu <interface>

	local iface="$1"

	config_get fix_mtu "$iface" fix_mtu "0"

	if [ "$fix_mtu" = "1" ] ; then
		/usr/sbin/iptables -t mangle -A POSTROUTING -p tcp --tcp-flags SYN,RST SYN -o "$iface" -j TCPMSS --clamp-mss-to-pmtu
	fi
}

config_load network
config_foreach fix_mtu interface

exit 0
