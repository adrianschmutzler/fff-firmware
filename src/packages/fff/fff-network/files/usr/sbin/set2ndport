#!/bin/sh

# This sets the port mode on second port without switch

if ! [ "$(uci -q get fff.ui.portsetup)" = "2ndport" ] ; then
	echo "Wrong device. This is for two-port devices without switch only!"
	exit 1
fi

LAN0MODE=$1

CLIENT_PORTS="0t"
BATMAN_PORTS="0t"

if [ "$LAN0MODE" = "CLIENT" ] ; then
	CLIENT_PORTS="$CLIENT_PORTS 1"
elif [ "$LAN0MODE" = "BATMAN" ] ; then
	BATMAN_PORTS="$BATMAN_PORTS 1"
else
	echo "Wrong port mode. Choose one of: CLIENT, BATMAN"
	exit 1
fi

uci set "network.eth1_1.ports=$CLIENT_PORTS"
uci set "network.eth1_3.ports=$BATMAN_PORTS"
uci commit network

/etc/init.d/network restart

echo "Port updated successfully."
