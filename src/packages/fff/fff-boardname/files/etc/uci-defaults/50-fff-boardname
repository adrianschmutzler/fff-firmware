#!/bin/sh

BOARD="$(cat /var/sysinfo/board_name)"

. /lib/functions/fff/boardident

case "$BOARD" in
    tl-wr1043nd)
        BOARD=tl-wr1043nd-v1
        ;;
    tl-wr1043nd-v2)
        grep "v3" /var/sysinfo/model && BOARD=tl-wr1043nd-v3
        ;;
    tl-wr741nd)
        grep "Atheros AR7240 rev 2" /proc/cpuinfo && BOARD=tl-wr741nd-v2 || BOARD=tl-wr741nd-v4
        ;;
    tl-wr741nd-v4)
        grep 740 /var/sysinfo/model && BOARD=tl-wr740n-v4
        ;;
    tl-wr841n-v7)
        BOARD=tl-wr841-v7
        ;;
    tl-wr841n-v8)
        BOARD=tl-wr841-v8
        ;;
    tl-wr841n-v9)
        BOARD=tl-wr841-v9
        grep "v10" /var/sysinfo/model && BOARD=tl-wr841-v10
        ;;
    tl-wr841n-v11)
        BOARD=tl-wr841-v11
        grep "v12" /var/sysinfo/model && BOARD=tl-wr841-v12
        ;;
    nanostation-m)
        BOARD=ubnt-nano-m
        ;;
    nanostation-m-xw)
        BOARD=ubnt-nano-m-xw
        ;;
    bullet-m)
        BOARD=ubnt-bullet-m
        grep -i "Pico" /var/sysinfo/model && BOARD=ubnt-pico-m
        grep -i "Loco" /var/sysinfo/model && BOARD=ubnt-loco-m
        ;;
    unifi)
        BOARD=ubnt-unifi
        ;;
    loco-m-xw)
        BOARD=ubnt-loco-m-xw
        grep -i "Power" /var/sysinfo/model && BOARD=ubnt-power-m-xw
        ;;
    unifiac-lite)
        BOARD=ubnt-unifiac-lite
        grep -i "MESH" /var/sysinfo/model && BOARD=ubnt-unifiac-mesh
        ;;
    tl-wa850re)
        BOARD=tl-wa850re-v1
        ;;
    tl-wa860re)
        BOARD=tl-wa860re-v1
        ;;
    tl-wdr3500)
        BOARD=tl-wdr3500-v1
        ;;
    tl-wdr4300)
        grep "3600" /var/sysinfo/model && BOARD=tl-wdr3600-v1
        grep "4300" /var/sysinfo/model && BOARD=tl-wdr4300-v1
        grep "4310" /var/sysinfo/model && BOARD=tl-wdr4310-v1
        ;;
    tl-mr3020)
        BOARD=tl-mr3020-v1
        ;;
    archer-c7)
        BOARD=archer-c7-v2
        ;;
    ubnt,bullet-m)
        BOARD=ubnt_bullet-m
        MODEL="$(ubnt_xm_board_detect)"
        echo "$MODEL" | grep -iq "Pico" && BOARD=ubnt_pico-m
        echo "$MODEL" | grep -iq "Loco" && BOARD=ubnt_loco-m
        ;;
esac

uci set board.model.name="$(echo "$BOARD" | sed 's/^tplink,//' | sed 's/^glinet,//' | sed 's/,/_/')" # remove tplink/glinet prefix and replace "vendor,device" with "vendor_device"
uci commit board
